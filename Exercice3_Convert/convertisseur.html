<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Convertisseur</title>
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Staatliches&display=swap" rel="stylesheet">
    

  
    <!-- linking style.css file-->
    <style>
        body {
            background-color: aliceblue;
            
        }
        
        h1{
            width: 100%;
            text-align: center;
        }
        
        hr {
            border-top: 2px solid black;
            width: 40%;
            margin-bottom: 55px;
        }
       
        .moneyConvert{
            width: 40%;
            margin: 0 auto;
            text-align: center;
            border: solid 2px black;
            border-radius: 20px;
            padding: 20px;
            margin-top : 20px;
        }
        input{
            width: 100%;
            height: 40px;
            margin-bottom: 10px;
            text-align: center;
        }
        
    </style>
</head>
  
<body>
    <div>
		<h1 style="margin-top: 0; width :100%;height: 150px; background-color:black; text-align: center; color:white; line-height: 150px;"><a style=" color:white; font-size: 15pt; position: absolute; top: -40px; left:20px" href="https://duray.info/ExercicesJS/"> <<< Retour </a>Exercices JS </h1>
	</div>
    <h1>Convertisseur de monnaies</h1>    
  
    <hr>
    <div class="moneyConvert">
  
        <div class="main">
  
            <div class="form-group">
                <label for="amount">
                    <h3>Montant à convertir</h3>
                </label>
                <input type="text" 
class="form-control " 
                       placeholder="1" 
                       id="amount" value="1">

            </div>
  
            <div class="row">
                <div class="col-sm-6">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Convertir des</span>
                        </div>
                        <select class="form-control from" id="sel1">
                            
                            <option value="ARS">ARS - Peso Argentin </option>
                            <option value="AUD">AUD - Dollar australien</option>
                            <option value="BRL">BRL - Réal brésilien</option>
                            <option value="CAD">CAD - Dollar canadien</option>
                            <option value="CHF">CHF - Franc suisse</option>
                            <option value="CLP">CLP - Peso chilien</option>
                            <option value="CNY">CNY - Renminbi </option>
                            <option value="CZK">CZK - Couronne tchèque</option>
                            <option value="DKK">DKK - Couronne danoise</option>
                            <option value="EUR">EUR - Euro </option>
                            <option value="GBP">GBP - Livre sterling</option>
                            <option value="HKD">HKD - Dollar Hong Kong</option>
                            <option value="HRK">HRK - Kuna Croate</option>
                            <option value="HUF">HUF - Forint</option>
                            <option value="INR">INR - Roupie indienne </option>
                            <option value="ISK">ISK - Couronne islandaise</option>
                            <option value="JPY">JPY - Yen</option>
                            <option value="KRW">KRW - Won sud-coréen </option>
                            <option value="NZD">NZD - Dollar Néo-Zélandais</option>
                            <option value="RON">RON - Leu roumain</option>
                            <option value="RUB">RUB - Rouble russe</option>
                            <option value="SEK">SEK - couronne suédoise</option>
                            <option value="SGD">SGD - Dollar de Singapour</option>
                            <option value="THB">THB - Baht </option>
                            <option value="TRY">TRY - livre turque </option>
                            <option value="TWD">TWD - Nouveau dollar de taiwan</option>
                            <option value="USD">USD - Dollar américain</option>
                            
                            
                        </select>
                    </div>
                </div>
  
                <div class="col-sm-6">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">En</span>
                        </div>
                        <select class="form-control to" id="sel2">
                            <option value="ARS">ARS - Peso Argentin </option>
                            <option value="AUD">AUD - Dollar australien</option>
                            <option value="BRL">BRL - Réal brésilien</option>
                            <option value="CAD">CAD - Dollar canadien</option>
                            <option value="CHF">CHF - Franc suisse</option>
                            <option value="CLP">CLP - Peso chilien</option>
                            <option value="CNY">CNY - Renminbi </option>
                            <option value="CZK">CZK - Couronne tchèque</option>
                            <option value="DKK">DKK - Couronne danoise</option>
                            <option value="EUR">EUR - Euro </option>
                            <option value="GBP">GBP - Livre sterling</option>
                            <option value="HKD">HKD - Dollar Hong Kong</option>
                            <option value="HRK">HRK - Kuna Croate</option>
                            <option value="HUF">HUF - Forint</option>
                            <option value="INR">INR - Roupie indienne </option>
                            <option value="ISK">ISK - Couronne islandaise</option>
                            <option value="JPY">JPY - Yen</option>
                            <option value="KRW">KRW - Won sud-coréen </option>
                            <option value="NZD">NZD - Dollar Néo-Zélandais</option>
                            <option value="RON">RON - Leu roumain</option>
                            <option value="RUB">RUB - Rouble russe</option>
                            <option value="SEK">SEK - couronne suédoise</option>
                            <option value="SGD">SGD - Dollar de Singapour</option>
                            <option value="THB">THB - Baht </option>
                            <option value="TRY">TRY - livre turque </option>
                            <option value="TWD">TWD - Nouveau dollar de taiwan</option>
                            <option value="USD">USD - Dollar américain</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
  
        <div id="finalAmount" class="text-center">
                <h2>Valeur convertie: 
                <p class="finalValue" >
                </p>
            </h2>
        </div>
    </div>
    <div class="moneyConvert">
        <h4>Convertisseur en bitcoin</h4>
        <label for="bitnumber">Entrez la valeur à convertir </label>
        <input type="text" id="bitnumber" value="1">
        <select class="form-control to" id="sel3">
            <option value="ARS">ARS - Peso Argentin </option>
            <option value="AUD">AUD - Dollar australien</option>
            <option value="BRL">BRL - Réal brésilien</option>
            <option value="CAD">CAD - Dollar canadien</option>
            <option value="CHF">CHF - Franc suisse</option>
            <option value="CLP">CLP - Peso chilien</option>
            <option value="CNY">CNY - Renminbi </option>
            <option value="CZK">CZK - Couronne tchèque</option>
            <option value="DKK">DKK - Couronne danoise</option>
            <option value="EUR">EUR - Euro </option>
            <option value="GBP">GBP - Livre sterling</option>
            <option value="HKD">HKD - Dollar Hong Kong</option>
            <option value="HRK">HRK - Kuna Croate</option>
            <option value="HUF">HUF - Forint</option>
            <option value="INR">INR - Roupie indienne </option>
            <option value="ISK">ISK - Couronne islandaise</option>
            <option value="JPY">JPY - Yen</option>
            <option value="KRW">KRW - Won sud-coréen </option>
            <option value="NZD">NZD - Dollar Néo-Zélandais</option>
            <option value="RON">RON - Leu roumain</option>
            <option value="RUB">RUB - Rouble russe</option>
            <option value="SEK">SEK - couronne suédoise</option>
            <option value="SGD">SGD - Dollar de Singapour</option>
            <option value="THB">THB - Baht </option>
            <option value="TRY">TRY - livre turque </option>
            <option value="TWD">TWD - Nouveau dollar de taiwan</option>
            <option value="USD">USD - Dollar américain</option>
        </select>
        <h2 id="total"></h2>
    </div>
  
    <script>
            const url = 'https://blockchain.info/ticker'; 
            let i=0; 
            let resultat = document.querySelector('.finalValue')
            let montant = document.querySelector('#amount')
            let monnaieorigine = 0
            let monnaiefinale = 0
            let origine = document.querySelector('#sel1')
            let final = document.querySelector('#sel2')

            let money = document.querySelector('#bitnumber')
            let country = document.querySelector('#sel3')
            let total = document.querySelector('#total')
            let bitcoin = 0

            if(localStorage.getItem('MonnaieBitcoin')){
                country.value = localStorage.getItem('MonnaieBitcoin')
            }
            if(localStorage.getItem('MonnaieOrigine')){
                origine.value = localStorage.getItem('MonnaieOrigine')
            }
            if(localStorage.getItem('MonnaieFinale')){
                final.value = localStorage.getItem('MonnaieFinale')
            }



            fetch(url)
                .then(res=>{
                    if(res.ok){
                        res.json().then(data=>{
                            console.log(data)

                            for(const cle in data){
                                if(cle === origine.value){
                                    monnaieorigine = data[cle].last
                                }
                                if(cle === final.value){
                                    monnaiefinale = data[cle].last
                                }
                                resultat.innerHTML = (monnaieorigine / monnaiefinale) * 1

                                final.addEventListener('change',() => {
                                    
                                        if(cle === final.value){
                                            monnaieorigine = data[cle].last
                                            resultat.innerHTML = ""
                                            resultat.innerHTML = (monnaieorigine / monnaiefinale)*montant.value 

                                            localStorage.setItem('MonnaieFinale', final.value)
                                        }
                                        
                                    
                                })
                                origine.addEventListener('change',() => {
                                    if(cle === origine.value){
                                        monnaiefinale = data[cle].last
                                        let calcul =  monnaiefinale / monnaieorigine
                                        resultat.innerHTML = ""
                                        resultat.innerHTML = calcul
                                        
                                        localStorage.setItem('MonnaieOrigine', origine.value)
                                    }
                                })
                                
                                montant.addEventListener('input', () => {
                                // si la valeur entrée sera 1 et pas de texte autorisé
                                while (isNaN(montant.value)) {
                                    montant.value = 1
                                }
                                resultat.innerHTML = monnaieorigine / monnaiefinale * montant.value
        
                                return i;
                                })

                                //convertisseur de bitcoin
                                if(cle === country.value){
                                    bitcoin = data[cle].last
                                }
                                //écouter le changement de valeur dans l'input 
                                country.addEventListener('change',() => {
                                    if(cle === country.value){
                                        bitcoin = data[cle].last
                                        let calcul =  bitcoin * money.value
                                        total.innerHTML = ""
                                        total.innerHTML = calcul 

                                        localStorage.setItem('MonnaieBitcoin', country.value)
                                    }
                                })

                                money.addEventListener('input', () => {
                                // si la valeur entrée sera 1 et pas de texte autorisé
                                while (isNaN(money.value)) {
                                    money.value = 1
                                }
                                total.innerHTML = bitcoin * money.value
        
                                return i;
                                })
                            }
                        })
                    } else {
                        console.log("erreur")
                    }
                })
                    
    </script>
</body>